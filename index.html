<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LockSmith ðŸ”‘ Password-protected link maker</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ”’</text></svg>"
    />
    <!-- (top-level styling unchanged) -->
    <style>
      :root {
        --primary: #2563eb;
        --primary-dark: #1e40af;
        --radius: 12px;
        --gray: #6b7280;
      }
      * {
        box-sizing: border-box;
        font-family: system-ui, sans-serif;
      }
      body {
        margin: 0;
        min-height: 100vh;
        color: #111827;
        background: #ffffff;
        font-size: 1rem;
        line-height: 1.55;
      }
      header {
        background: radial-gradient(
          circle at top left,
          #f0f4ff 0%,
          #ffffff 60%
        );
        padding: 5rem 1rem 4rem;
        text-align: center;
      }
      h1 {
        font-size: 2.25rem;
        margin: 0 0.5rem 1rem;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }
      h2 {
        font-size: 1.5rem;
        margin: 3.5rem 0 1.2rem;
        text-align: center;
      }
      p {
        max-width: 720px;
        margin: 0.7rem auto 0;
        padding: 0 1rem;
      }
      a {
        color: var(--primary-dark);
      }
      a:hover {
        text-decoration: none;
      }
      #installBtnContainer {
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        padding: 0.65rem 1.1rem;
        font-size: 1.05rem;
        font-weight: 600;
        border: 1px solid #d1d5db;
        border-radius: 7px;
        background: #f3f4f6;
        color: #111827;
        text-decoration: none;
        box-shadow: inset 0 1px 0 #fff;
        transition: background 0.18s;
      }
      #installBtn {
        font-size: 1.05rem;
        font-weight: 600;
        color: #111827;
        text-decoration: none;
      }
      #installBtnContainer:hover {
        background: #e5e7eb;
      }
      .tip {
        margin-top: 0.8rem;
        font-size: 0.88rem;
        color: var(--gray);
      }
      section {
        padding: 1rem 1rem 0;
        max-width: 900px;
        margin: 0 auto;
      }
      pre {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 7px;
        padding: 1rem;
        font-size: 0.85rem;
        white-space: pre-wrap;
        word-break: break-all;
        margin-top: 1rem;
        overflow: auto;
      }
      .card {
        width: min(460px, 94%);
        margin: 1.5rem auto 3rem;
        background: #fff;
        border-radius: var(--radius);
        padding: 2rem 1.8rem 2.2rem;
        box-shadow: 0 15px 28px rgba(0, 0, 0, 0.1);
      }
      label {
        display: block;
        margin-top: 1.05rem;
        font-weight: 500;
      }
      input[type="text"],
      input[type="password"] {
        width: 100%;
        margin-top: 0.35rem;
        padding: 0.6rem 0.7rem;
        border: 1px solid #d1d5db;
        border-radius: 7px;
        font-size: 1rem;
      }
      input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.25);
      }
      #build {
        margin-top: 1.55rem;
        width: 100%;
        padding: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
        color: #fff;
        background: var(--primary);
        border: none;
        border-radius: 7px;
        cursor: pointer;
        transition: background 0.18s;
      }
      #build:hover {
        background: var(--primary-dark);
      }
      #result {
        text-align: center;
        margin-top: 2rem;
      }
      #link,
      #dragTip {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        background: #f3f4f6;
        color: #111827;
        padding: 0.55rem 0.95rem;
        border: 1px solid #d1d5db;
        border-radius: 7px;
        font-weight: 500;
        font-size: 0.92rem;
        text-decoration: none;
        box-shadow: inset 0 1px 0 #fff;
      }
      #link:hover {
        background: #e5e7eb;
      }
      #dragTip {
        margin-top: 0.9rem;
        pointer-events: none;
        font-size: 0.84rem;
      }
      footer {
        border-top: 1px solid #e5e7eb;
        margin-top: 4rem;
        padding: 2rem 1rem;
        font-size: 0.83rem;
        color: var(--gray);
        text-align: center;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>LockSmith <span>ðŸ”‘</span></h1>
      <p>How to install LockSmith:</p>
      <span id="installBtnContainer"
        >ðŸ”’<a id="installBtn" href="">LockSmith</a></span
      >
      <p class="tip">
        Drag this button to your bookmarks bar to install the LockSmith
        bookmarklet.
      </p>
    </header>
    <section>
      <h2>What are bookmarklets?</h2>
      <p>
        Bookmarklets are tiny JavaScript programs saved as browser bookmarks.
        Click a bookmarklet and it runs code on the page youâ€™re viewingâ€”no
        extensions, no installs, just a link.
      </p>
      <h2>LockSmith&nbsp;â‡’ a bookmarklet that <em>makes</em> bookmarklets</h2>
      <p>
        LockSmith itself is a bookmarklet. Click it and a modal pops up that
        lets you build <strong>LockLinks</strong>â€”password-protected
        bookmarklets that hide any URL you choose. Share a LockLink plus its
        password and only people who know the secret can visit the hidden URL.
      </p>
    </section>

    <section>
      <h2>License</h2>
      <p>
        LockSmith is released under the <a href="#license">MIT License</a>.
        Youâ€™re free to use, modify and share it.
      </p>
      <h2>Security&nbsp;notes</h2>
      <p>
        LockLinks use AES-256-GCM encryption in your browser. No data leaves
        your device. Strength still depends on the password you chooseâ€”pick
        something unique and hard to guess.
      </p>
    </section>
    <footer>
      Â© 2025 LockSmith â€¢
      <a href="https://github.com/markdavison/locksmith">GitHub repo</a>
    </footer>

    <script>
      (() => {
        /* --------------------------------------------------------------------
                 1.  Generator HTML (full LockLink builder inside iframe)
              -------------------------------------------------------------------- */
        const generatorHTML = `
      <!doctype html><html lang="en"><meta charset="utf-8"><title>LockLink generator</title><style>body{margin:0;font-family:system-ui,sans-serif;background:#f9fafb;display:flex;align-items:center;justify-content:center;height:100vh} .box{background:#fff;padding:1.8rem 1.6rem;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.08);width:min(420px,90%);} h2{margin:0 0 1.1rem;font-size:1.4rem;text-align:center} label{display:block;margin-top:1rem;font-weight:500} input{width:100%;margin-top:.35rem;padding:.55rem .65rem;border:1px solid #d1d5db;border-radius:6px;font-size:1rem} input:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.25)} button{margin-top:1.4rem;width:100%;padding:.65rem;font-size:1rem;font-weight:600;color:#fff;background:#2563eb;border:none;border-radius:6px;cursor:pointer} #out{margin-top:1.6rem;text-align:center;font-size:.9rem} a.btn{display:inline-block;background:#2563eb;color:#fff;padding:.55rem .9rem;border-radius:6px;text-decoration:none;font-weight:600} a.btn:hover{background:#1e40af} #tip{margin-top:.8rem;color:#555} pre{margin-top:1rem;background:#f3f4f6;padding:.7rem;border-radius:6px;white-space:pre-wrap;word-break:break-all;border:1px solid #e5e7eb;font-size:.8rem}</style><body><div class="box"><h2>LockLink ðŸ”’</h2><label>URL<input id="u" placeholder="https://example.com"></label><label>Password<input id="p" type="password"></label><label>Name<input id="n" placeholder="LockLink â†’"></label><button id="make">Make Link</button><div id="out"></div></div><script>(()=>{document.getElementById("u").value="__CURRENT_URL__";const te=new TextEncoder(),td=new TextDecoder(),b64=b=>btoa(String.fromCharCode(...new Uint8Array(b)));const rand=n=>crypto.getRandomValues(new Uint8Array(n));const enc=async(txt,pw)=>{const salt=rand(16),iv=rand(12),km=await crypto.subtle.importKey("raw",te.encode(pw),"PBKDF2",false,["deriveKey"]),key=await crypto.subtle.deriveKey({name:"PBKDF2",salt,iterations:100000,hash:"SHA-256"},km,{name:"AES-GCM",length:256},false,["encrypt"]),ct=await crypto.subtle.encrypt({name:"AES-GCM",iv},key,te.encode(txt));return \`\${b64(
        salt
      )}.\${b64(iv)}.\${b64(
          ct
        )}\`};document.getElementById("make").addEventListener("click",async()=>{const url=u.value.trim(),pw=p.value,label=n.value.trim()||"LockLink â†’";if(!url||!pw)return alert("Both fields required");const blob=await enc(url,pw);const code=\`javascript:(async()=>{try{const te=new TextEncoder(),td=new TextDecoder(),b=s=>Uint8Array.from(atob(s),c=>c.charCodeAt(0)),[a,bv,c]='${"${blob}"}'.split('.'),salt=b(a),iv=b(bv),data=b(c),pass=prompt('Password?');if(pass===null)return;const km=await crypto.subtle.importKey('raw',te.encode(pass),'PBKDF2',false,['deriveKey']),key=await crypto.subtle.deriveKey({name:'PBKDF2',salt,iterations:100000,hash:'SHA-256'},km,{name:'AES-GCM',length:256},false,['decrypt']),plain=td.decode(await crypto.subtle.decrypt({name:'AES-GCM',iv},key,data));/^https?:/.test(plain)?location.href=plain:alert('Incorrect password');}catch(e){alert('Incorrect password');}})();\`;out.innerHTML='';const a=document.createElement('a');a.className='btn';a.textContent=label;a.href=code;out.appendChild(a);const tip=document.createElement('div');tip.id='tip';tip.textContent='Drag this to your bookmarks bar';out.appendChild(tip);const pre=document.createElement('pre');pre.textContent=code;out.appendChild(pre);});})();<\/script></body></html>`;

        /* --------------------------------------------------------------------
                 2. Bookmarklet BODY (modal loader)
              -------------------------------------------------------------------- */
        const bookmarkletBody = `
              (function(){if(document.getElementById('locksmith-modal'))return;const modal=document.createElement('div');modal.id='locksmith-modal';modal.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:2147483647';const frame=document.createElement('iframe');frame.setAttribute('sandbox','allow-scripts');frame.style.cssText='width:100%;max-width:460px;height:540px;border:none;border-radius:14px;background:#fff';frame.srcdoc=${JSON.stringify(
                generatorHTML
              )}.replace('__CURRENT_URL__', document.URL);modal.appendChild(frame);modal.addEventListener('click',e=>{if(e.target===modal)modal.remove();});window.addEventListener('keydown',e=>{if(e.key==='Escape'&&modal.parentNode)modal.remove();});document.body.appendChild(modal);})();`;

        /* 3. Final bookmarklet URL */
        const bookmarkletURL =
          "javascript:" + encodeURIComponent(bookmarkletBody);
        document.getElementById("installBtn").href = bookmarkletURL;
      })();
    </script>
  </body>
</html>
